<iscomment> Custom Start: include cloudinary shrinkwrap. </iscomment>
<isset name="CLDImagePageTypeSettings" value="${JSON.parse(dw.system.Site.current.preferences.custom.CLDImagePageTypeSettings)}" scope="page"/>
<isif condition="${(CLDImagePageTypeSettings.plp.enabled && CLDImagePageTypeSettings.plp.automateResponsivenessWithJS) || (CLDImagePageTypeSettings.quickview.enabled && CLDImagePageTypeSettings.quickview.automateResponsivenessWithJS)
    || (CLDImagePageTypeSettings.cldPlpSwatch.enabled && CLDImagePageTypeSettings.cldPlpSwatch.automateResponsivenessWithJS)
}">
    <isinclude template="include/cloudinaryShrinkwrap"/>
</isif>

<isif condition="${dw.system.Site.current.preferences.custom.CLDGalleryEnabled}">
    <script src="${dw.system.Site.current.preferences.custom.CLDGalleryJSURL}" onload="window.cldProductGallery = cloudinary; window.renderCloudinaryGalleryWidget();"></script>
</isif>
<iscomment> Custom End: include cloudinary shrinkwrap. </iscomment>

<isloop items="${pdict.productSearch.productIds}" var="product">
    <div class="col-6 col-sm-4">
        <isobject object="${product.productSearchHit}" view="searchhit">
            <iscomment>Custom start: Add cloudinary page type</iscomment>
            <isset name="cloudinaryConstants" value="${require('*/cartridge/scripts/util/cloudinaryConstants')}" scope="page" />
            <isif condition="${pdict.cloudinary && pdict.cloudinary.isEnabled && (pdict.cloudinary.galleryEnabled || pdict.cloudinary.isGalleryEnabled)}">
                <link rel="preload" href="${cloudinaryConstants.CLD_BASE_PATH + '/' + cloudinaryConstants.CLD_VIDEO_RESOURCE_TYPE + '/list/'+ pdict.product.CLDTagName +'.json'}" as="fetch" crossorigin />
                <link rel="preload" href="${cloudinaryConstants.CLD_BASE_PATH + '/' + cloudinaryConstants.CLD_IMAGE_RESOURCE_TYPE + '/list/'+ pdict.product.CLDTagName +'.json'}" as="fetch" crossorigin />
            </isif>
            <isif condition="${CloudinaryConstants.CLD_360_SPINSETS_ENABLED}">
                <link rel="preload" href="${cloudinaryConstants.CLD_BASE_PATH + '/' + cloudinaryConstants.CLD_SPIN_SET_RESOURCE_TYPE + '/list/'+ pdict.product.CLDTagName + CloudinaryConstants.CLD_360_SPIN_SET_TAG_SUFFIX +'.json'}" as="fetch" crossorigin />
            </isif>
            <isif condition="${CloudinaryConstants.CLD_3D_OBJECTS_ENABLED}">
                <link rel="preload" href="${cloudinaryConstants.CLD_BASE_PATH + '/' + cloudinaryConstants.CLD_3D_OBJECT_TAG_SUFFIX + '/list/'+ pdict.product.CLDTagName + CloudinaryConstants.CLD_3D_OBJECT_TAG_SUFFIX_SLASH+'.json'}" as="fetch" crossorigin />
            </isif>
            <isinclude url="${URLUtils.url('Tile-Show', 'pid', product.productID, 'swatches', true,
                'ratings', true, 'pageType', 'plp', 'pageTypeSwatches', 'cldPlpSwatch')}" />
            <iscomment>Custom end: Add cloudinary page type</iscomment>
        </isobject>
    </div>
</isloop>
